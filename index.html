<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>슬라임 보스 게임</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    background: #222;
    color: #fff;
    font-family: Arial, sans-serif;
    overflow: hidden;
    user-select: none;
  }
  canvas {
    display: block;
    margin: 10px auto;
    background: #111;
    border: 2px solid #888;
  }
  #ui {
    width: 400px;
    margin: auto;
    display: flex;
    justify-content: space-between;
    font-size: 18px;
    padding: 5px 10px;
  }
  #weaponToggle {
    cursor: pointer;
    background: #555;
    border: none;
    color: white;
    padding: 5px 10px;
    font-size: 18px;
    border-radius: 5px;
  }
</style>
</head>
<body>
<div id="ui">
  <div>HP: <span id="playerHp">100</span>%</div>
  <div>Boss HP: <span id="bossHp">300</span></div>
  <button id="weaponToggle">무기 전환</button>
</div>
<canvas id="game" width="400" height="600"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const player = {
  x: 200,
  y: 550,
  size: 20,
  color: "cyan",
  hp: 100,
  speed: 3,
  baseSpeed: 3,
  weapon: "sword",
  arrows: [],
};

const boss = {
  x: 200,
  y: 100,
  size: 60,
  color: "green",
  hp: 300,
  attackCooldown: 0
};

class Slime {
  constructor(x, y, color) {
    this.x = x;
    this.y = y;
    this.size = 15;
    this.color = color;
    this.hp = 20;
    this.status = {burning:false, slow:false};
    this.burningTimer = 0;
    this.slowTimer = 0;
  }
  draw() {
    ctx.fillStyle = this.color;
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.size, 0, Math.PI*2);
    ctx.fill();
    if(this.status.burning) {
      ctx.strokeStyle = "rgba(255, 69, 0, 0.7)";
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.size+3, 0, Math.PI*2);
      ctx.stroke();
    }
    if(this.status.slow) {
      ctx.strokeStyle = "rgba(0, 191, 255, 0.7)";
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.size+3, 0, Math.PI*2);
      ctx.stroke();
    }
  }
}

const slimes = [
  new Slime(100, 300, "red"),
  new Slime(300, 350, "purple"),
  new Slime(150, 400, "blue"),
];

const keys = {};
window.addEventListener("keydown", e => { keys[e.key.toLowerCase()] = true; });
window.addEventListener("keyup", e => { keys[e.key.toLowerCase()] = false; });

document.getElementById("weaponToggle").addEventListener("click", () => {
  if(player.weapon === "sword") player.weapon = "bow";
  else player.weapon = "sword";
});

function swordAttack() {
  const attackRadius = player.size + 30;
  for(let slime of slimes) {
    let dx = slime.x - player.x;
    let dy = slime.y - player.y;
    let dist = Math.sqrt(dx*dx + dy*dy);
    if(dist < attackRadius + slime.size) {
      slime.hp -= 10;
      if(slime.color === "red") slime.status.burning = true, slime.burningTimer = 150;
      else if(slime.color === "purple") slime.hp -= 2;
      else if(slime.color === "blue") slime.hp -= 5;
      if(slime.hp <= 0) slimes.splice(slimes.indexOf(slime), 1);
    }
  }
  let dx = boss.x - player.x;
  let dy = boss.y - player.y;
  let dist = Math.sqrt(dx*dx + dy*dy);
  if(dist < attackRadius + boss.size) {
    boss.hp -= 15;
  }
}

function shootArrow() {
  if(player.arrows.length >= 3) return;
  player.arrows.push({
    x: player.x,
    y: player.y - player.size - 10,
    width: 4,
    height: 10,
    speed: 7,
  });
}

function update() {
  let moveX = 0, moveY = 0;
  if(keys["a"] || keys["arrowleft"]) moveX -= 1;
  if(keys["d"] || keys["arrowright"]) moveX += 1;
  if(keys["w"] || keys["arrowup"]) moveY -= 1;
  if(keys["s"] || keys["arrowdown"]) moveY += 1;
  let norm = Math.sqrt(moveX*moveX + moveY*moveY);
  if(norm > 0) {
    moveX /= norm;
    moveY /= norm;
  }
  player.x += moveX * player.speed;
  player.y += moveY * player.speed;
  if(player.x < player.size) player.x = player.size;
  if(player.x > canvas.width - player.size) player.x = canvas.width - player.size;
  if(player.y < player.size) player.y = player.size;
  if(player.y > canvas.height - player.size) player.y = canvas.height - player.size;

  for(let slime of slimes) {
    if(slime.status.burning) {
      slime.burningTimer--;
      if(slime.burningTimer <= 0) slime.status.burning = false;
    }
    if(slime.status.slow) {
      slime.slowTimer--;
      if(slime.slowTimer <= 0) slime.status.slow = false;
    }
  }

  for(let i = player.arrows.length - 1; i >= 0; i--) {
    let arrow = player.arrows[i];
    arrow.y -= arrow.speed;
    if(arrow.y + arrow.height < 0) {
      player.arrows.splice(i, 1);
      continue;
    }
    for(let slime of slimes) {
      let dx = arrow.x - slime.x;
      let dy = arrow.y - slime.y;
      let dist = Math.sqrt(dx*dx + dy*dy);
      if(dist < slime.size + arrow.width/2) {
        slime.hp -= 8;
        if(slime.color === "red") slime.status.burning = true, slime.burningTimer = 150;
        else if(slime.color === "purple") slime.hp -= 2;
        else if(slime.color === "blue") slime.hp -= 5;
        if(slime.hp <= 0) slimes.splice(slimes.indexOf(slime), 1);
        player.arrows.splice(i, 1);
        break;
      }
    }
    let dx = arrow.x - boss.x;
    let dy = arrow.y - boss.y;
    let dist = Math.sqrt(dx*dx + dy*dy);
    if(dist < boss.size + arrow.width/2) {
      boss.hp -= 10;
      player.arrows.splice(i, 1);
    }
  }

  for(let slime of slimes) {
    let dx = slime.x - player.x;
    let dy = slime.y - player.y;
    let dist = Math.sqrt(dx*dx + dy*dy);
    if(dist < slime.size + player.size) {
      if(slime.color === "red") {
        player.hp -= 0.5;
        slime.status.burning = true;
        slime.burningTimer = 150;
      }
      else if(slime.color === "purple") {
        player.hp -= 0.5;
      }
      else if(slime.color === "blue") {
        player.hp -= 0.2;
        player.speed = player.baseSpeed * 0.6;
        slime.status.slow = true;
        slime.slowTimer = 60;
      }
    }
  }

  if(slimes.some(s => s.status.burning)) {
    player.hp -= 0.02;
  } else {
    player.speed = player.baseSpeed;
  }

  if(boss.attackCooldown > 0) {
    boss.attackCooldown--;
  } else {
    // 여기서 보스 공격 패턴 추가 가능
    boss.attackCooldown = 300;
  }

  if(player.hp < 0) player.hp = 0;
  if(boss.hp < 0) boss.hp = 0;

  document.getElementById("playerHp").textContent = Math.floor(player.hp);
  document.getElementById("bossHp").textContent = Math.floor(boss.hp);
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // 플레이어
  ctx.fillStyle = player.color;
  ctx.beginPath();
  ctx.arc(player.x, player.y, player.size, 0, Math.PI*2);
  ctx.fill();

  // 슬라임
  for(let slime of slimes) slime.draw();

  // 보스
  ctx.fillStyle = boss.color;
  ctx.beginPath();
  ctx.arc(boss.x, boss.y, boss.size, 0, Math.PI*2);
  ctx.fill();

  // 화살
  ctx.fillStyle = "yellow";
  for(let arrow of player.arrows) {
    ctx.fillRect(arrow.x - arrow.width/2, arrow.y, arrow.width, arrow.height);
  }
}

function gameLoop() {
  update();
  draw();
  requestAnimationFrame(gameLoop);
}

window.addEventListener("keydown", e => {
  if(e.key === " " && player.weapon === "sword") {
    swordAttack();
  }
  if(e.key === " " && player.weapon === "bow") {
    shootArrow();
  }
});

gameLoop();
</script>
</body>
</html>
